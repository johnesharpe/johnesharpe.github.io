<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR.js Augmented Reality</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

    <!-- Add your 3D model entity -->
    <a-entity id="model" scale="0.1 0.1 0.1"></a-entity>

    <!-- Password form -->
    <form id="passwordForm">
      <label for="password">Password:</label>
      <input type="password" id="password" required>
      <button type="submit">Submit</button>
    </form>

    <!-- Location input form (hidden by default) -->
    <form id="locationForm" style="display: none;">
      <label for="latitude">Latitude:</label>
      <input type="text" id="latitude" required>
      <br>
      <label for="longitude">Longitude:</label>
      <input type="text" id="longitude" required>
      <br>
      <button type="submit">Set Location</button>
    </form>

    <!-- Script to handle password and location form submission -->
    <script>
      // Password authentication
      var authorized = false;
      var passwordForm = document.getElementById('passwordForm');
      var locationForm = document.getElementById('locationForm');

      function authenticatePassword(password) {
        // Replace "YOUR_PASSWORD" with your desired password
        if (password === "Wh1tmarsh") {
          authorized = true;
          passwordForm.style.display = 'none';
          locationForm.style.display = 'block';
        }
      }

      passwordForm.addEventListener('submit', function(event) {
        event.preventDefault();
        var passwordInput = document.getElementById('password');
        var password = passwordInput.value;
        authenticatePassword(password);
        passwordInput.value = '';
      });

      // Handle location form submission
      locationForm.addEventListener('submit', function(event) {
        event.preventDefault();
        if (!authorized) return;
        var latitudeInput = document.getElementById('latitude');
        var longitudeInput = document.getElementById('longitude');
        var latitude = parseFloat(latitudeInput.value);
        var longitude = parseFloat(longitudeInput.value);

        // Set the location based on latitude and longitude
        var markerLocation = new THREEx.ArMarkerControls.MarkerLocation(latitude, longitude);

        // Create an AR.js marker using the marker location
        var marker = document.createElement('a-marker');
        marker.setAttribute('type', 'barcode');
        marker.setAttribute('value', '42');
        marker.setAttribute('position', markerLocation);
        marker.appendChild(document.getElementById('model'));
        document.querySelector('a-scene').appendChild(marker);

        // Reset the form inputs
        latitudeInput.value = '';
        longitudeInput.value = '';
      });

      // Automatically extract and display zip contents upon file selection
      window.addEventListener('DOMContentLoaded', function() {
        var modelUpload = document.getElementById('modelUpload');
        modelUpload.addEventListener('change', function(event) {
          var file = event.target.files[0];
          extractZipFile(file);
        });

        // Automatically trigger the file input click
        var fileInput = document.getElementById('modelUpload');
        fileInput.click();
      });
    </script>

    <!-- Hidden file input element -->
    <input type="file" id="modelUpload" accept=".zip" style="display: none;">

    <a-entity camera></a-entity>
  </a-scene>
</body>
</html>
